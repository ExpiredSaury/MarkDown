[TOC]





## 01ã€ç†è®º

[æ“ä½œç³»ç»Ÿå‘å±•å²](https://www.cnblogs.com/Dominic-Ji/articles/10929381.html)

#### å¤šé“æŠ€æœ¯

**å•æ ¸å®ç°å¹¶å‘çš„æ•ˆæœ**

* å¹¶è¡Œï¼šçœŸæ­£æ„ä¹‰ä¸Šçš„åŒæ—¶æ‰§è¡Œ

* å¹¶å‘ï¼šçœ‹ä¸Šå»åƒåŒæ—¶è¿è¡Œçš„

ps:

* å¹¶è¡Œå±äºå¹¶å‘
* å•æ ¸è®¡ç®—æœºè‚¯å®šä¸èƒ½å®ç°å¹¶è¡Œï¼Œä½†æ˜¯å¯ä»¥å®ç°å¹¶å‘

#### 

æ—¶é—´ä¸Šçš„å¤ç”¨ä¸ç©ºé—´ä¸Šçš„å¤ç”¨

* ç©ºé—´ä¸Šçš„å¤ç”¨ï¼š
  * å¤šä¸ªç¨‹åºå…±ç”¨ä¸€å¥—è®¡ç®—æœº
* æ—¶é—´ä¸Šçš„å¤ç”¨ï¼š
  * æ´—è¡£æœ30s ã€åšé¥­30sã€çƒ§æ°´40s
  * å•é“éœ€è¦110sï¼Œèº²åˆ°åªéœ€è¦ä»»åŠ¡æ—¶é•¿æœ€é•¿çš„å“ªä¸€ä¸ª           
  * ps ï¼šè¾¹åƒé¥­ï¼Œè¾¹æ‰“æ¸¸æˆï¼Œ

  * **åˆ‡æ¢+ä¿å­˜çŠ¶æ€**

```python
"""
åˆ‡æ¢ï¼ˆCPUï¼‰åˆ†ä¸ºä¸¤ç§æƒ…å†µ
	1. å½“ä¸€ä¸ªç¨‹åºé‡åˆ°IOæ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šå‰¥å¤ºè¯¥ç¨‹åºçš„CPUæ‰§è¡Œæƒé™
	   ä½œç”¨ï¼šæé«˜äº†CPUçš„åˆ©ç”¨ç‡ï¼Œå¹¶ä¸å½±å“ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡
	   
    2. å½“ä¸€ä¸ªç¨‹åºé•¿æ—¶é—´å ç”¨CPUçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šå‰¥å¤ºè¯¥ç¨‹åºçš„CPUæ‰§è¡Œæƒé™
       ä½œç”¨ï¼šé™ä½äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œï¼ˆåŸæœ¬çš„æ—¶é—´+åˆ‡æ¢çš„æ—¶é—´ï¼‰
     
    
"""
```

## 02ã€è¿›ç¨‹

* ç¨‹åºä¸è¿›ç¨‹çš„åŒºåˆ«

```python
"""
ç¨‹åºå°±æ˜¯ä¸€å †èººåœ¨ç¡¬ç›˜ä¸Šçš„ä»£ç ï¼Œæ˜¯â€œæ­»â€çš„
è¿›ç¨‹åˆ™è¡¨ç¤ºç¨‹åºæ­£åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œæ˜¯â€œæ´»â€çš„
"""
```

**è¿›ç¨‹çš„è°ƒåº¦**

* å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•

  ```python
  """å¯¹é•¿ä½œä¸šæœ‰åˆ©ï¼Œå¯¹çŸ­ä½œä¸šæ— ç›Š"""
  ```

* çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•

  ```python
  """å¯¹çŸ­ä½œä¸šæœ‰åˆ©ã€‚å¯¹é•¿ä½œä¸šæ— ç›Š"""
  ```

* æ—¶é—´ç‰‡è½®è½¬æ³•+å¤šçº§åé¦ˆé˜Ÿåˆ—

  ```PYTHON
  """
  æ—¶é—´ç‰‡ï¼šå°†å›ºå®šçš„æ—¶é—´åˆ†ä¸ºNå¤šä»½ï¼Œæ¯ä¸€ä»½å°±è¡¨ç¤ºä¸€ä¸ªæ—¶é—´ç‰‡
  """
  ```

#### è¿›ç¨‹è¿è¡Œçš„ä¸‰çŠ¶æ€å›¾
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](E:\MarkDown\markdown\imgs\f69d209520c1472fb8efbda62f3d5761.png)

* **å°±ç»ªæ€**ï¼šä¸€åˆ‡ç¨‹åºå¿…é¡»å…ˆç»è¿‡å°±ç»ªæ€ï¼Œæ‰èƒ½åŠ å…¥è¿è¡Œæ€
* **è¿è¡Œæ€**ï¼šæ­£åœ¨è¢«CPUæ‰§è¡Œ
* **é˜»å¡æ€**ï¼šç¨‹åºé‡åˆ°IOæ“ä½œ

#### åŒæ­¥å’Œå¼‚æ­¥

```python
"""æè¿°çš„æ˜¯ä»»åŠ¡çš„æäº¤æ–¹å¼"""
```

* **åŒæ­¥**ï¼šä»»åŠ¡æäº¤ä¹‹åï¼Œ**åŸåœ°ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœ**ï¼Œç­‰å¾…çš„è¿‡ç¨‹ä¸­**ä¸åšä»»ä½•äº‹**ï¼ˆå¹²ç­‰ï¼‰ â€œ  ç¨‹åºå±‚é¢ä¸Šè¡¨ç°å‡ºæ¥çš„æ˜¯å¡ä½äº†â€

* **å¼‚æ­¥**ï¼šä»»åŠ¡æäº¤åï¼Œ**ä¸åŸåœ°ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœ**ï¼Œç›´æ¥**å»åšå…¶ä»–äº‹æƒ…**ï¼Œ

  	â€ä»»åŠ¡çš„è¿”å›ç»“æœä¼šæœ‰ä¸€ä¸ªå¼‚æ­¥å›è°ƒæœºåˆ¶è‡ªåŠ¨å¤„ç†â€œ

#### é˜»å¡å’Œéé˜»å¡

```python
"""æè¿°çš„æ˜¯ç¨‹åºçš„è¿è¡ŒçŠ¶æ€"""
```

* é˜»å¡ï¼šé˜»å¡æ€

* éé˜»å¡ï¼šå°±ç»ªæ€ï¼Œè¿è¡Œæ€

**ç†æƒ³çŠ¶æ€**ï¼šæˆ‘ä»¬åº”è¯¥è®©æˆ‘ä»¬å†™çš„ä»£ç æ°¸è¿œ**å¤„äºå°±ç»ªæ€å’Œè¿è¡Œæ€**ä¹‹é—´åˆ‡æ¢

ä¸Šè¿°æ¦‚å¿µä¸­æœ€é«˜æ•ˆçš„ä¸€ç§ç»„åˆæ˜¯**å¼‚æ­¥éé˜»å¡**



#### å¼€å¯è¿›ç¨‹çš„ä¸¤ç§æ–¹å¼

ä»£ç å¼€å¯è¿›ç¨‹å’Œçº¿ç¨‹çš„æ–¹å¼ï¼Œä»£ç ä¹¦å†™åŸºæœ¬æ˜¯ä¸€è‡´çš„

* ç¬¬ä¸€ç§

```python
from multiprocessing import Process
import time

def task(name):
    print('{} is running'.format(name))
    time.sleep(3)
    print('%s is over' % name)
    
if __name__ == '__main__':
    #1.åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡
    p=Process(target=task,args=('zhao',))
    #å®¹å™¨ç±»å‹å“ªæ€•é‡Œé¢åªæœ‰1ä¸ªå…ƒç´ ï¼Œå»ºè®®ä¸€å®šè¦ç”¨é€—å·éš”å¼€
    #2.å¼€å¯è¿›ç¨‹
    p.start()  #å‘Šè¯‰æ“ä½œç³»ç»Ÿå¸®ä½ åˆ›å»ºä¸€ä¸ªè¿›ç¨‹  ,å¼‚æ­¥
    print('ä¸»è¿›ç¨‹')
    
    
#æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š
"""
ä¸»è¿›ç¨‹
zhao is running
zhao is over
"""
   
```

* windows æ“ä½œç³»ç»Ÿä¸‹ï¼Œä¸€å®šè¦å†mainä¸‹åˆ›å»ºè¿›ç¨‹

* å› ä¸ºwindowsä¸‹åˆ›å»ºè¿›ç¨‹ã€‚ç±»ä¼¼äºæ¨¡å—å¯¼å…¥çš„æ–¹å¼

* ä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œä»£ç 

* linuxä¸­åˆ™æ˜¯ç›´æ¥å°†ä»£ç æ‹·è´ä¸€ä»½

---

* ç¬¬äºŒç§,ç±»çš„ç»§æ‰¿

```python
from mutiprocessing import Process
import time

class MyProcess(Process):
    def run(self):
        print('hello,bf girl')
        time.sleep(2)
        print('get out!!')
if __name__  == '__main__':
    p=MyProcess()
    p.start()
    print('ä¸»è¿›ç¨‹')
```

æ€»ç»“ï¼š

```python
"""
åˆ›å»ºè¿›ç¨‹å°±æ˜¯åœ¨å†…å­˜ä¸­ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´ï¼Œå°†éœ€è¦è¿è¡Œçš„ä»£ç ä¸¢è¿›å»
ä¸€ä¸ªè¿›ç¨‹å¯¹åº”åœ¨å†…å­˜ä¸­å°±æ˜¯ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
å¤šä¸ªè¿›ç¨‹å¯¹åº”åœ¨å†…å­˜ä¸­å°±æ˜¯å¤šå—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ•°æ®é»˜è®¤æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥äº¤äº’ï¼Œå¦‚æœæƒ³äº¤äº’å¯ä»¥å€ŸåŠ©äºç¬¬ä¸‰æ–¹å·¥å…·ã€æ¨¡å—
"""
```

#### è¿›ç¨‹å¯¹è±¡çš„join æ–¹æ³•

joinæ˜¯è®©ä¸»è¿›ç¨‹çš„ä»£ç ç­‰å¾…å­è¿›ç¨‹ä»£ç è¿è¡Œç»“æŸä¹‹åï¼Œå†ç»§ç»­è¿è¡Œï¼Œä¸å½±å“å…¶ä»–å­è¿›ç¨‹çš„æ‰§è¡Œ

```python
from multiprocessing import Process
import time

def task(name):
    print('{} is running'.format(name))
    time.sleep(3)
    print('%s is over' % name)
    
if __name__ == '__main__':
    #1.åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡
    p=Process(target=task,args=('zhao',))
    #å®¹å™¨ç±»å‹å“ªæ€•é‡Œé¢åªæœ‰1ä¸ªå…ƒç´ ï¼Œå»ºè®®ä¸€å®šè¦ç”¨é€—å·éš”å¼€
    #2.å¼€å¯è¿›ç¨‹
    p.start()  #ä»…ä»…æ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿè¦åˆ›å»ºè¿›ç¨‹
    p.join()#ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹pè¿è¡Œç»“æŸä¹‹åå†ç»§ç»­å¾€åæ‰§è¡Œ
    print('ä¸»è¿›ç¨‹')
```

```python
start_time=time.time()
for i in range(3):
    p=Process(target=task,args=('å­è¿›ç¨‹%s'%i,i))
    p.start()
    p.join()
print('ä¸»',time.time()-start_time)#è€—æ—¶6ç§’å¤š
#ç›¸å½“äºå˜æˆä¸²è¡Œï¼Œå°†å¹¶å‘å˜æˆä¸²è¡Œï¼Œç¨‹åºæ•ˆç‡é™ä½
```

```python
start_time=time.time()
p_list=[]
for i in range(3):
    p=Process(target=task,args=('å­è¿›ç¨‹%s'%i,i))
    p.start()
    p_list.append(p)
    
for p in p_list:
    p.join()
print('ä¸»',time.time()-start_time)#è€—æ—¶3ç§’å¤šä¸€ç‚¹

```



#### è¿›ç¨‹ä¹‹é—´æ•°æ®ç›¸äº’éš”ç¦»ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰

```python
money=100
def task():
    global money
    money=666
if __name__ == '__main__':
 
    p=Process(target=task)
    p.start()
    p.join()
    print(money) # 100
```

[å›¾çµæœºå™¨äºº](http://www.turingapi.com/)

[ç§‘å¤§è®¯é£](https://www.iflytek.com/index.html)

#### è¿›ç¨‹å¯¹è±¡åŠå…¶ä»–æ–¹æ³•

```python
"""ä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œç€å¾ˆå¤šè¿›ç¨‹ï¼Œé‚£ä¹ˆè®¡ç®—æœºæ˜¯å¦‚ä½•åŒºåˆ†å¹¶ç®¡ç†è¿™äº›è¿›ç¨‹æœåŠ¡ç«¯ çš„å‘¢

è®¡ç®—æœºä¼šç»™æ¯ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹åˆ†é…ä¸€ä¸ªPIDå·
windowsï¼Œcmdåè¾“å…¥tasklist
tasklist |firsttr  PID  #æŸ¥çœ‹å…·ä½“çš„è¿›ç¨‹

linuxï¼šps aux
	ps aux |grep PID #æŸ¥çœ‹å…·ä½“çš„è¿›ç¨‹
"""
```



[Pycharmæ¿€æ´»ç½‘ç«™](https://idea.medeming.com/pycharm)



```python
from multiprocessing import Process,current_process
import time,os


def task():
    #print("%s is running"%current_process().pid)#æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·
     print("%s is running"%os.getpid())#æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·
     print("å­è¿›ç¨‹çš„ä¸»è¿›ç¨‹å·æ˜¯ï¼š%s "%os.getppid())#å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·
    time.sleep(3)

    
if __name__ == '__main__':
    p=Process(target=task)
    p.start()
    #p.terminate()#æ€æ­»å½“å‰è¿›ç¨‹ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿå¸®ä½ å»æ€æ­»è¿›ç¨‹ï¼Œä½†æ˜¯éœ€è¦æ—¶é—´ï¼Œè€Œä»£ç çš„è¿è¡Œé€Ÿåº¦æå¿«
    #print(p.is_alive())#åˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦å­˜æ´»
    print('ä¸»è¿›ç¨‹',os.getpid())
    print('ä¸»ä¸»',os.getppid())#è·å–çˆ¶è¿›ç¨‹çš„PID
    
```

ä¸€èˆ¬æƒ…å†µä¸‹ä¼šé»˜è®¤å°†å­˜å‚¨å¸ƒå°”å€¼çš„å˜é‡åå’Œè¿”å›çš„ç»“æœæ˜¯å¸ƒå°”å€¼çš„æ–¹æ³•å

éƒ½èµ·æˆä»¥is_å¼€å¤´

#### åƒµå°¸è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹

```python
#åƒµå°¸è¿›ç¨‹
"""
æ­»äº†æ²¡æ­»é€
å½“ä½ å¼€è®¾äº†å­è¿›ç¨‹åï¼Œè¯¥è¿›ç¨‹æ­»åä¸ä¼šç«‹å³é‡Šæ”¾å ç”¨çš„è¿›ç¨‹å·
å› ä¸ºè¦è®©çˆ¶è¿›ç¨‹èƒ½å¤ŸæŸ¥çœ‹åˆ°å®ƒå¼€è®¾çš„å­è¿›ç¨‹çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå ç”¨çš„PIDå·ï¼Œè¿è¡Œæ—¶é—´ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šæ­¥å…¥åƒµå°¸è¿›ç¨‹
	çˆ¶è¿›ç¨‹ä¸æ­»ï¼Œå¹¶ä¸”åœ¨æ— é™åˆ¶çš„åˆ›å»ºå­è¿›ç¨‹å¹¶ä¸”å­è¿›ç¨‹ä¹Ÿä¸ä¼šç»“æŸ
	å›æ”¶å­è¿›ç¨‹å ç”¨çš„pidå·ï¼š
		çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹è¿è¡Œç»“æŸ
		çˆ¶è¿›ç¨‹è°ƒç”¨joinæ–¹æ³•
	
"""
#å­¤å„¿è¿›ç¨‹
"""
å­è¿›ç¨‹å­˜æ´»ï¼Œçˆ¶è¿›ç¨‹æ„å¤–æ­»äº¡
æ“ä½œç³»ç»Ÿä¼šå¼€è®¾ä¸€ä¸ªâ€œå„¿ç«¥ç¦åˆ©é™¢â€ï¼Œä¸“é—¨ç®¡ç†å­¤å„¿è¿›ç¨‹å›æ”¶ç›¸å…³èµ„æº
"""

```

#### å®ˆæŠ¤è¿›ç¨‹

```python
from multiprocessing import Process
import time
def task(name='lisi'):
    print('%sæ€»ç®¡æ­£å¸¸æ´»ç€'%name)
    time.sleep(2)
    print("%sæ€»ç®¡æ­£å¸¸æ­»äº¡"%name)
if __name__ == '__main__':
    p=Process(target=task,kwargs={'name':'zhangsan'})
    p.daemon=True#å°†è¿›ç¨‹pè®¾ç½®æˆå®ˆæŠ¤è¿›ç¨‹ï¼Œæ”¾åœ¨startæ–¹æ³•ä¸Šé¢æ‰æœ‰æ•ˆï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™
    p.start() 
 
    print("ä¸»è¿›ç¨‹")
```

#### äº’æ–¥é”

é’ˆå¯¹å¤šä¸ªè¿›ç¨‹æ“ä½œåŒä¸€ä»½æ•°æ®çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®é”™ä¹±çš„é—®é¢˜ï¼Œ

é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œè§£å†³æ–¹å¼å°±æ˜¯åŠ é”å¤„ç†ï¼š**å°†å¹¶å‘å˜æˆä¸²è¡Œï¼Œç‰ºç‰²æ•ˆç‡ä½†æ˜¯ä¿è¯æ•°æ®å®‰å…¨**



```python
"""æ¨¡æ‹Ÿå¼ºç¥¨"""
from multiprocessing import Process,Lock
import json,time
import random 
#æŸ¥ç¥¨
def search(i):
   #æ–‡ä»¶æ“ä½œè¯»å–ç¥¨æ•°
	with open('data','r',encoding='utf8') as fp:
    	dic= json.load(fp)
   	print('ç”¨æˆ·%sæŸ¥è¯¢ä½™ç¥¨:%s'%(i,dic.get('ticket_num')))
    #å­—å…¸å–å€¼ä¸è¦ç”¨[]çš„å½¢å¼ï¼Œæ¨èä½¿ç”¨getï¼Œä½¿ç”¨getä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™
   
#ä¹°ç¥¨ 1.å…ˆæŸ¥ï¼Œ2.å†ä¹°
def buy(i):
    #æŸ¥
    with open('data','r',encoding='utf8') as fp:
    	dic= json.load(fp)
   	#æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
    time.sleep(random.randint(1,3))
    #åˆ¤è¯»å½“å‰æ˜¯å¦æœ‰ä½™ç¥¨
    if dic.get('ticket_num') > 0:
        #ä¿®æ”¹æ•°æ®åº“ï¼Œä¹°ç¥¨
        dic['ticket_num'] -= 1
        #å†™å…¥æ•°æ®åº“
        with open('data','w',encoding='utf8') as fp:
            json.dump(dic,fp)
        print("ç”¨æˆ·%sä¹°ç¥¨æˆåŠŸ"%i)
    else:
        print('ç”¨æˆ·%sä¹°ç¥¨å¤±è´¥'%i)
    
def run(i,mutex):
    search(i)
    #ä¹°ç¥¨ç¯èŠ‚åŠ é”å¤„ç†
    #æŠ¢é”
    mutex.acquire()
    buy(i)
    #é‡Šæ”¾é”
    mutex.release()
if __name__ == '__main__':
    #åœ¨ä½è¿›ç¨‹ä¸­ç”Ÿæˆä¸€æŠŠé”ï¼Œè®©å­è¿›ç¨‹æŠ¢ï¼Œè°å…ˆæŠ¢åˆ°è°ä¹°ç¥¨
    mutex=Lock()
    for i in range(1,10):
        p=Process(target=run,args=(i,mutex))
        p.start()

        """
        æ‰©å±•ï¼šè¡Œé”ï¼Œè¡¨é”
        	è¡Œé”ï¼šæ“ä½œè¡¨æ ¼ä¸­çš„ä¸€è¡Œæ•°æ®çš„æ—¶å€™å…¶ä»–äººéƒ½ä¸èƒ½æ“ä½œ
        	è¡¨é”ï¼›æ“ä½œä¸€å¼ è¡¨çš„æ—¶å€™å…¶ä»–äººéƒ½ä¸èƒ½æ“ä½œ
        æ³¨æ„ï¼š
        	1.é”ä¸è¦è½»æ˜“çš„ä½¿ç”¨ï¼Œå®¹æ˜“é€ æˆæ­»é”ç°è±¡ï¼Œéƒ½æ˜¯å†…éƒ¨å°è£…å¥½çš„
        	2.é”åªåœ¨å¤„ç†æ•°æ®çš„éƒ¨åˆ†å‘¢åŠ ï¼Œä¿è¯æ•°æ®å®‰å…¨ï¼ˆåªåœ¨ äº‰æŠ¢æ•°æ®çš„ç¯èŠ‚åŠ é”å¤„ç†å³å¯ï¼‰
        """
```

#### è¿›ç¨‹é—´é€šä¿¡(Queue)

è¿›ç¨‹ä¹‹é—´æ˜¯æ— æ³•ç›´æ¥è¿›è¡Œæ•°æ®äº¤äº’çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡é˜Ÿåˆ—æ´»ç€ç®¡é“å®ç°æ•°æ®äº¤äº’

```python
q.put()#å¾€é˜Ÿåˆ—ä¸­å­˜æ•°æ®
q.get() #é˜Ÿåˆ—ä¸­å¦‚æœå·²ç»æ²¡æœ‰æ•°æ®çš„è¯ï¼Œgetæ–¹æ³•ä¼šåŸåœ°é˜»å¡
print(q.full())#åˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦æ»¡äº†
print(q.empty())#åˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦ç©ºäº†
print(q.qsize())#é˜Ÿåˆ—é‡Œæ•°æ®çš„ä¸ªæ•°
q.get_nowait()#æ²¡æœ‰æ•°æ®ç›´æ¥æŠ¥é”™queue.Empty
q.get(timeout=3)#æ²¡æœ‰æ•°æ®ä¹‹ååŸåœ°ç­‰å¾…3ç§’å†æŠ¥é”™
```



**é˜Ÿåˆ—Queueæ¨¡å—**

```python
"""
ç®¡é“ï¼šsubprocess   
	stdin  stdout stderr
é˜Ÿåˆ—ï¼šç®¡é“+é”


é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡º
å †æ ˆï¼šå…ˆè¿›åå‡º

"""
#import queue 
#åˆ›å»ºé˜Ÿåˆ—
#q=queue.Queue(5)#æ‹¬å·å†…å¯ä»¥ä¼ æ•°å­—ï¼Œè¡¨ç¤ºç”Ÿæˆçš„é˜Ÿåˆ—æœ€å¤§åŒæ—¶å¯ä»¥å­˜æ”¾çš„æ•°æ®é‡
from multiprocessing import Queue
q=Queue(5)

#å¾€é˜Ÿåˆ—ä¸­å­˜æ•°æ®
q.put(111)
q.put(222)
q.put(333)
print(q.full())#åˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦æ»¡äº†
print(q.empty())#åˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦ç©ºäº†
q.put(444)
q.put(555)
print(q.qsize)#é˜Ÿåˆ—é‡Œæ•°æ®çš„ä¸ªæ•°
#q.put(666)#å½“é˜Ÿåˆ—æ•°æ®æ”¾æ»¡äº†ä¹‹åï¼Œï¼Œå¦‚æœè¿˜æœ‰æ•°æ®è¦æ”¾ï¼Œç¨‹åºä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰ä½ç½®è®©å‡ºæ¥ï¼Œä¸ä¼šæŠ¥é”™
"""
å­˜å–æ•°æ®ï¼šå­˜æ˜¯ä¸ºäº†æ›´å¥½çš„å–
åƒæ–¹ç™¾è®¡çš„å­˜ï¼Œç®€å•å¿«æ·çš„å–
"""
#å»é˜Ÿåˆ—ä¸­å–æ•°æ•°æ®
v1=q.get()
v2=q.get()
v3=q.get()
v4=q.get()
v5=q.get()
try:
    v6=q.get(timeout=3)
    print(v6)
except Exception as e:
    print(e)


#v6=q.get_nowait()#æ²¡æœ‰æ•°æ®ç›´æ¥æŠ¥é”™queue.Empty
#v6=q.get(timeout=3)#æ²¡æœ‰æ•°æ®ä¹‹ååŸåœ°ç­‰å¾…3ç§’å†æŠ¥é”™
#v6=q.get()#é˜Ÿåˆ—ä¸­å¦‚æœå·²ç»æ²¡æœ‰æ•°æ®çš„è¯ï¼Œgetæ–¹æ³•ä¼šåŸåœ°é˜»å¡
print(v1,v2,v3,v4,v5,v6)



"""
q.full()
q.empty()
q.get_nowait()
ä¸Šé¢è¿™ä¸‰ä¸ªæ–¹æ³•å¯¹è¿›ç¨‹çš„æƒ…å†µä¸‹æ˜¯ä¸ç²¾ç¡®çš„

"""
```

#### IPCæœºåˆ¶

```python
"""
ç ”ç©¶æ€è·¯ï¼š
	1.ä¸»è¿›ç¨‹è·Ÿå­è¿›ç¨‹å€ŸåŠ©äºé˜Ÿåˆ—é€šä¿¡
	2.å­è¿›ç¨‹è·Ÿå­è¿›ç¨‹å€ŸåŠ©äºé˜Ÿåˆ—é€šä¿¡
"""
"""ä¸»è¿›ç¨‹è·Ÿå­è¿›ç¨‹å€ŸåŠ©äºé˜Ÿåˆ—é€šä¿¡"""
from multiprocessing import Queue,Process
def producer(q):
    q.put('ç‡•å­æä¸‰')
    print('hello')
    
if __name__ == '__main__':  
    q=Queue()
    p=Process(target=producer,args=(q,))
    p.start()
    print(q.get())
  
"""å­è¿›ç¨‹è·Ÿå­è¿›ç¨‹å€ŸåŠ©äºé˜Ÿåˆ—é€šä¿¡"""
from multiprocessing import Queue,Process
def producer(q):
    q.put('ç‡•å­æä¸‰')
    
def consumer(q):
    print(q.get())
if __name__ == '__main__':  
    q=Queue()
    p=Process(target=producer,args=(q,))
    p1=Process(target=consumer,args=(q,))
    p.start()
    p1.start()
```

#### ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹

```python
"""
ç”Ÿäº§è€…ï¼›
	ç”Ÿäº§/åˆ¶é€ ä¸œè¥¿çš„
æ¶ˆè´¹è€…ï¼š
	æ¶ˆè´¹/å¤„ç†ä¸œè¥¿çš„

è¯¥æ¨¡å‹é™¤äº†ä¸Šè¿°ä¸¤ä¸ªä¹‹å¤–è¿˜éœ€è¦ä¸€ä¸ªåª’ä»‹
	ç”Ÿæ´»ä¸­çš„ä¾‹å­åšåŒ…å­ï¼Œå°†åŒ…å­åšå¥½ä¹‹åæ”¾åœ¨è’¸ç¬¼é‡Œï¼ˆåª’ä»‹ï¼‰ï¼Œä¹°åŒ…å­çš„å–è’¸ç¬¼é‡Œé¢æ‹¿
	å¨å¸ˆåšèœåšå®Œä¹‹åç”¨ç›˜å­è£…ç€ç»™ä½ æ¶ˆè´¹è€…é€’è¿‡å»
	ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¸æ˜¯ç›´æ¥åšäº¤äº’çš„ï¼Œè€Œæ˜¯å€ŸåŠ©äºåª’ä»‹åšäº¤äº’
ç”Ÿäº§è€…ï¼ˆåšåŒ…å­ï¼‰  + æ¶ˆæ¯é˜Ÿåˆ— ï¼ˆè’¸ç¬¼ï¼‰ + æ¶ˆè´¹è€…ï¼ˆå®¢äººï¼‰
 

"""
from multiprocessing import Process,Queue
import time,random


def producer(name,food,q):
   for i in range():
    	data='%sç”Ÿäº§äº†%s,%s'%(name,food,i)
        time.sleep(random.randint(1,3))
        print(data)
        q.put(data)
    
def consumer(name,q):
    while True:
        food=q.get()
        #åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰ç»“æŸçš„è¡¨ç¤º
        if food is None:break
        time.sleep(random.randint(1,3))
        print('%såƒäº†%s'%(name,food))
 
if __name__ == '__main__':  
    q=Queue()
    p1=Process(target=producer,args=('å¤§å¨','åŒ…å­',q))
    p2=Process(target=producer,args=('å¼ æ¡‘','å…»ç”Ÿæ±¤',q))
    c1=Process(target=consumer,args=('æå››',q))
    c2=Process(target=consumer,args=('ç‹äº”',q))
    p1.start()
    p2.start()
    c1.start()
    c2.start()
    
    p1.join()
    p2.join()
    #ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§å®Œæ¯•ä¹‹åï¼Œå¾€é˜Ÿåˆ—ä¸­æ·»åŠ ç‰¹å®šçš„ç»“æŸç¬¦å·
    q.put(None)#è‚¯å®šåœ¨æ‰€æœ‰ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®æœ«å°¾
    q.put(None)
    #æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…æ‰€ä»¥è¦æ”¾ä¸¤ä¸ªNone
    
```

```python
from multiprocessing import Process,JoinableQueue
import time,random


def producer(name,food,q):
   for i in range():
    	data='%sç”Ÿäº§äº†%s,%s'%(name,food,i)
        time.sleep(random.randint(1,3))
        print(data)
        q.put(data)
    
def consumer(name,q):
    while True:
        food=q.get()
  
       
        time.sleep(random.randint(1,3))
        print('%såƒäº†%s'%(name,food))
        q.task_done()#å‘Šè¯‰é˜Ÿåˆ—ä½ å·²ç»ä»é‡Œé¢å–å‡ºäº†ä¸€ä¸ªæ•°æ®å¹¶ä¸”å¤„ç†å®Œæ¯•äº†
 
if __name__ == '__main__':  
    q=JoinableQueue()
    p1=Process(target=producer,args=('å¤§å¨','åŒ…å­',q))
    p2=Process(target=producer,args=('å¼ æ¡‘','å…»ç”Ÿæ±¤',q))
    c1=Process(target=consumer,args=('æå››',q))
    c2=Process(target=consumer,args=('ç‹äº”',q))
    p1.start()
    p2.start()
    #å°†æ¶ˆè´¹è€…è®¾ç½®æˆå®ˆæŠ¤è¿›ç¨‹
    c1.daemon=True
    c2.daemon=True
    c1.start()
    c2.start()
    
    p1.join()
    p2.join()
	q.join()#ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„æ•°æ®è¢«å–å®Œå†å¾€ä¸‹æ‰§è¡Œä»£ç 
"""
JoinableQueue æ¯å½“å¾€é˜Ÿåˆ—ä¸­å­˜å…¥æ•°æ®çš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šæœ‰ä¸€ä¸ªè®¡æ•°å™¨+1
æ¯å½“è°ƒç”¨task_doneçš„æ—¶å€™ï¼Œè®¡æ•°å™¨-1
q.join()å½“è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œæ‰å¾€åè¿è¡Œ
"""
#åªè¦q.join()æ‰§è¡Œå®Œæ¯•ï¼Œè¯´æ˜æ¶ˆè´¹è€…å·²ç»æ‰§è¡Œå®Œæ¯•äº†ï¼Œæ¶ˆè´¹å€¼å·²ç»æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†
```

## 03ã€çº¿ç¨‹



* ä»€ä¹ˆæ˜¯çº¿ç¨‹

  ```PYTHON
  """
  è¿›ç¨‹æ˜¯èµ„æºå•ä½ï¼ˆå¼€å¯ä¸€ä¸ªè¿›ç¨‹ä»…ä»…æ˜¯åœ¨å†…å­˜ç©ºé—´ä¸­å¼€å¯ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼‰
  çº¿ç¨‹æ˜¯æ‰§è¡Œå•ä½ï¼ˆçœŸæ­£CPUæ‰§è¡Œçš„å…¶å®æ˜¯è¿›ç¨‹é‡Œé¢çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‡çš„å°±æ˜¯ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ‰§è¡Œä»£ç ä¸­æ‰€éœ€è¦ä½¿ç”¨åˆ°çš„èµ„æºéƒ½å‘æ‰€åœ¨çš„è¿›ç¨‹æ‰€è¦ï¼‰
  
  å°†æ“ä½œç³»ç»Ÿæ¯”å–»æˆä¸€å¤§çš„å·¥å‚ï¼Œè€Œè¿›ç¨‹ ç›¸å½“äºå·¥å‚é‡Œé¢çš„è½¦é—´
  è€Œçº¿ç¨‹æ˜¯è½¦é—´é‡Œé¢çš„æµæ°´çº¿
  
  æ¯ä¸€ä¸ªè¿›ç¨‹è‚¯å®šè‡ªå¸¦ä¸€ä¸ªçº¿ç¨‹
  
  è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯è™šæ‹Ÿå•ä½ï¼Œåªæ˜¯ä¸ºäº†æˆ‘ä»¬æ›´æ–¹ä¾¿çš„æè¿°é—®é¢˜
  """
  
  ```

  

  * ä¸ºä½•è¦æœ‰è¿›ç¨‹

    ```python
    """
    å¼€è®¾è¿›ç¨‹
    	1.ç”³è¯·å†…å­˜ç©ºé—´ï¼Œè€—è´¹èµ„æº
    	2. â€˜æ‹·è´ä»£ç â€™  è€—è´¹èµ„æº
    å¼€è®¾çº¿ç¨‹
    	ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¼€è®¾å¤šä¸ªçº¿ç¨‹ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…å¼€è®¾å¤šä¸ªçº¿ç¨‹æ— éœ€ç”³è¯·å†…å­˜ç©ºé—´åŠæ‹·è´ä»£ç çš„æ“ä½œï¼Œ
    	å¼€è®¾çº¿ç¨‹çš„å¼€é”€è¿œè¿œå°äºè¿›ç¨‹çš„å¼€é”€
    """
    ```

  #### å¼€å¯çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼

  ```python
  from threading import Thread
  def task(name):
  	print("%s is  running "%name)
  #å¼€å¯çº¿ç¨‹ä¸éœ€è¦åœ¨mainä¸‹é¢æ‰§è¡Œä»£ç ï¼Œç›´æ¥ä¹¦å†™å°±å¯ä»¥
  #ä½†æ˜¯è¿˜æ˜¯ä¹ æƒ¯æ€§çš„å°†å¯åŠ¨å‘½ä»¤å†™åœ¨mainä¸‹é¢
  t=Thread(target=task,args=('zhao',))
  t.start()#åˆ›å»ºçº¿ç¨‹çš„å¼€é”€éå¸¸å°ï¼Œå‡ ä¹ä»£ç ä¸€æ‰§è¡Œçº¿ç¨‹å°±å·²ç»åˆ›å»ºäº†
  print('ä¸»')
  ```

  

  ```python
  from threading import Thread
  import time
  class MyThread(Thread):
      def __init__(self,name):
          #é‡å†™åˆ«äººçš„æ–¹æ³•ï¼Œåˆä¸çŸ¥é“åˆ«äººçš„æ–¹æ³•é‡Œé¢æœ‰å•¥ï¼Œå°±è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•
          super().__init__()
          self.name=name
      def run(self):
          print("%s is running "%self.name)
          time.sleep(3)
          print('lisi')
  if __name__ == '__main__':  
      t=MyThread('zhao')
      t.start()
      print('ä¸»')
  ```

  #### TCPæœåŠ¡ç«¯å®ç°å¹¶å‘çš„æ•ˆæœ

  ```python
  import socket
  from threading import Thread
  from multiprocessing import Process
  """
  æœåŠ¡ç«¯ï¼š
  	1. å›ºå®šçš„IPå’Œç«¯å£
  	2. 24å°æ—¶ä¸é—´æ–­æä¾›æœåŠ¡
  	3. èƒ½å¤Ÿæ”¯æŒå¹¶å‘
  	
  """
  
  server =socket.socket()#æ‹¬å·å†…ä¸åŠ æ“ä½œé»˜è®¤å°±æ˜¯TCPåè®®
  server.bind(('127.0.0.1',8080))
  server.listen(5)
  #å°†æœåŠ¡çš„ä»£ç å•ç‹¬å°è£…æˆä¸€ä¸ªå‡½æ•°
  def talk(conn):
      #é€šä¿¡å¾ªç¯
      while True:
          try:
          	data=conn.recv(1024)
              #é’ˆå¯¹mac.linuxå½“æ–­å¼€é“¾æ¥åï¼Œé¢‘ç¹æ”¶åˆ°ç©º
              if len(data) == 0:break
             	print(data.decode('utf-8'))
              conn.send(data.upper())
          except ConnectionResetError as e:
              print(e)
              break
  	conn.close()
      
  
  #é“¾æ¥å¾ªç¯
  while True:
      conn,addr=server.accept()#æ¥å®¢
      #å«å…¶ä»–äººæ¥æœåŠ¡
      t=Thread(target=talk,args=(conn,))
      t.start()
      
          
          
  ```

  ```python
  import socket
  client=socket.socket()
  client.connect(('127.0.0.1',8080))
  while True:
      client.send(b'hello')
      data=client.recv(1024)
      print(data.decode('utf-8'))
  
  ```

  

#### çº¿ç¨‹å¯¹è±¡çš„joinæ–¹æ³•

```python
from threading import  Thread
import time

def task(name):
    print('%s is running '%name)
    time.sleep(2)
    print("%s is over"%name)
if __name__ == '__main__':
    t=Thread(target=task,args=('zhao',))
    t.start()
    t.join()#ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹è¿è¡Œç»“æŸå†æ‰§è¡Œ
    print('ä¸»')
```

#### åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹æ˜¯å…±äº«çš„

```python
from threading import Thread
import time 

money =100
def task():
    global money
    money=666
    print(money)
if __name__ == '__main__':
    t=Thread(target=task)
    t.start()
    t.join()
    print(money)
```

#### çº¿ç¨‹å¯¹è±¡åŠå…¶ä»–æ–¹æ³•

```python
from threading import Thread,active_count,current_thread
import time,os

def task(n):
    #print('hello,world!!',os.getpid())
     print('hello,world!!',current_thrad().name)#è·å–å½“å‰çº¿ç¨‹çš„åå­—
    
if __name__ == '__mian__':
    t=Thread(target=task,args=(1,))
    t1=Thread(target=task,args=(2,))
    t.start()
    t1.start()
    t1.join()
    print('ä¸»',active_count())#ç»Ÿè®¡å½“å‰æ­£åœ¨æ´»è·ƒçš„çº¿ç¨‹æ•°
    print('ä¸»',os.getpid())
    print('ä¸»',current_thrad().name)#ä¸»çº¿ç¨‹ Main Thread
```

#### å®ˆæŠ¤çº¿ç¨‹

```python
from threading import Thread
import time

def task(name):
    print('%s is running '%name)
    time.sleep(1)
    print("%s is over"%name)
if __name__ == '__main__':
    t=Thread(target=task,args=('zhao',))
    t.daemon=True
    t.start()
    print('ä¸»')
    
    
"""
ä¸»çº¿ç¨‹è¿è¡Œç»“æŸä¹‹åä¸ä¼šç«‹å³ç»“æŸï¼Œä¼šç­‰å¾…å…¶ä»–éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ‰ä¼šç»“æŸ
ä¸»çº¿ç¨‹ç»“æŸæ„ä¸ºç€æ‰€åœ¨è¿›ç¨‹çš„ç»“æŸ
"""
```



```python
from threading import Thread
import time,os

def task():
    print(132)
    time.sleep(1)
    print('end123')
    
def func():
    print(456)
    time.sleep(3)
    print('end465')
if __name__ == '__main__':
    t1=Thread(target=task)
    t2=Thread(target=func)
    t1.daemon=True
    t1.start()
    t2.start()
    print('ä¸»')
    
#å®ˆæŠ¤çº¿ç¨‹ï¼šä¸»çº¿ç¨‹è¿è¡Œç»“æŸï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿè·Ÿç€ç»“æŸ

    
"""
 è¿è¡Œæµç¨‹ï¼š
 	t1.start()ç«‹é©¬æ‰“å°132ï¼Œt2.start()ç«‹é©¬æ‰“å°456ï¼Œç„¶åæ‰“å°"ä¸»",ä½†æ˜¯ä¸»çº¿ç¨‹ä¸ä¼šç«‹åˆ»ç»“æŸï¼Œå®ƒè¦ç­‰å¾…æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ‰èƒ½ç»“æŸï¼Œtaskç¡1ç§’ï¼Œfuncç¡3ç§’ï¼Œtaskç¡1ç§’ã€‚ç«‹é©¬æ‰“å°end123,ç„¶åæ‰“å°end456,


æ‰“å°ç»“æœï¼š	
 	132
 	456
 	ä¸»
 	end123
 	end456
    
"""
```

#### çº¿ç¨‹äº’æ–¥é”

```python
from threading import Thread,Lock
import time

money=100
mutex=Lock()    

def task():
	global money
    mutex.acquire()
    tmp=money
    time.sleep(0.1)
    money=tmp - 1
    mutex.release()

if __name__ =="__main__":
    
    t_list=[]
    for i in range(100):
        t=Thread(target=task)
        t.start()
        t_list.append(t)
    for t in t_list:
        t.join()
    print(money)
    
    

```

#### GILå…¨å±€è§£é‡Šå™¨é”ğŸ”’

```python
"""
In CPython,the global interpreter lock , or GIL, is a mutex that prevents multiple
native thrads from executing Python bytecodes at once,This lock is  necessary mainly
beacuse CPython's memory management is not thread-safe.(However, since the GIL exists, other features have grown to depend on the guarantees that is enforces)

"""
"""
Pythonè§£é‡Šå™¨å…¶å®æœ‰å¤šä¸ªç‰ˆæœ¬
	Cpython
	Jpython
	Pypypython
ä½†æ˜¯æœ€æ™®éä½¿ç”¨çš„è¿˜æ˜¯Cpythonè§£é‡Šå™¨

åœ¨Cpythonè§£é‡Šå™¨ä¸­ï¼ŒGILæ˜¯ä¸€æŠŠäº’æ–¥é”ï¼Œç”¨æ¥é˜»æ­¢åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹çš„åŒæ—¶æ‰§è¡Œ
åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªè¿›ç¨‹æ— æ³•åˆ©ç”¨å¤šä¸ªä¼˜åŠ¿ï¼ï¼ï¼
å› ä¸ºCPythonä¸­çš„å†…å­˜ç®¡ç†ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ
å†…å­˜ç®¡ç†ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰
	1. å¼•ç”¨è®¡æ•°
		
	2. æ ‡è®°æ¸…é™¤
	3. åˆ†ä»£å›æ”¶

é‡ç‚¹ï¼š
	1. GILä¸æ˜¯Pythonçš„ç‰¹ç‚¹ï¼Œè€Œæ˜¯Cpythonè§£é‡Šå™¨ç‰¹ç‚¹
	2. GILä¿è¯è§£é‡Šå™¨çº§åˆ«çš„æ•°æ®çš„å®‰å…¨
	3. GILä¼šå¯¼è‡´åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹æ— æ³•åŒæ—¶æ‰§è¡Œå³æ— æ³•åˆ©ç”¨å¤šä¸ªä¼˜åŠ¿
	4. é’ˆå¯¹ä¸åŒçš„æ•°æ®è¿˜æ˜¯éœ€è¦åŠ ä¸åŒçš„é”å¤„ç†
	5. è§£é‡Šå‹è¯­è¨€çš„é€šç—…ï¼šåŒä¸€ä¸ªè¿›ç¨‹ä¸‹å¤šä¸ªçº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿
	
"""
```

#### GILä¸æ™®é€šè§£é‡Šå™¨çš„åŒºåˆ«

```python
from threading import Thread,Lock
import time

mutex=Lock()
money=100


def task():
	global money   
    #with mutex:
    #    tmp = money
    #    time.sleep(0.1)
    #    money = tmp - 1
    mutex.acquire()
    tmp=money
    time.sleep(0.1)#åªè¦è¿›å…¥IOï¼ŒGILä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œ
    money=tmp - 1
    mutex.release()
   

if __name__ =="__main__":
    
    t_list=[]
    for i in range(100):
        t=Thread(target=task)
        t.start()
        t_list.append(t)
    for t in t_list:
        t.join()
    print(money)    
    
    """
    100ä¸ªçº¿ç¨‹å¼€å¯åï¼Œå…ˆå»æŠ¢GIL
    è¿›å…¥IOï¼ŒGILè‡ªåŠ¨é‡Šæ”¾ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªäº’æ–¥é”mutex
    å…¶ä»–çº¿ç¨‹è™½ç„¶æŠ¢åˆ°äº†GIL,ä½†æ˜¯æŠ¢ä¸åˆ°äº’æ–¥é”
    æœ€ç»ˆGILè¿˜æ˜¯å›åˆ°è‡ªå·±æ‰‹ä¸Šï¼Œè‡ªå·±å»æ“ä½œæ•°æ®
    
    
    """
```

#### åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šè¿›ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿æ˜¯ä¸æ˜¯å°±æ²¡æœ‰ç”¨

```python
"""
å¤šçº¿ç¨‹æ˜¯å¦æœ‰ç”¨è¦å…·ä½“çœ‹æƒ…å†µ
å•æ ¸:å››ä¸ªä»»åŠ¡ï¼ˆIOå¯†é›†å‹\è®¡ç®—å¯†é›†å‹ï¼‰
å¤šæ ¸:å››ä¸ªä»»åŠ¡ï¼ˆIOå¯†é›†å‹\è®¡ç®—å¯†é›†å‹ï¼‰

"""
#è®¡ç®—å¯†é›†å‹   æ¯ä¸ªä»»åŠ¡éƒ½éœ€è¦10s
å•æ ¸ï¼š
	å¤šè¿›ç¨‹ï¼šé¢å¤–çš„æ¶ˆè€—èµ„æº
    å¤šçº¿ç¨‹ï¼šå‡å°‘å¼€é”€
å¤šæ ¸ï¼š
	å¤šè¿›ç¨‹ï¼šæ€»è€—æ—¶10s+
    å¤šçº¿ç¨‹ï¼šæ€»è€—æ—¶40s+
    
#IO å¯†é›†å‹   æ¯ä¸ªä»»åŠ¡éƒ½éœ€è¦10s
å¤šæ ¸ï¼š
	å¤šè¿›ç¨‹:ç›¸å¯¹æµªè´¹èµ„æº
    å¤šçº¿ç¨‹ï¼šæ›´åŠ èŠ‚çœèµ„æº
```



```python
#è®¡ç®—å¯†é›†å‹
from multiprocessing import Process
from threading import Thread
import os ,time

def work():
    res=0
    for i in range(1000000000):
		res*=i
if __name__ =='__main__':
    l=[]
    print(os.cpu_count())#è·å–å½“å‰è®¡ç®—æœºCPUä¸ªæ•°
    start_time=time.time()
    for i in range(12):
        #p=Process(target=work)
        #p.start()
        #l.append(p)
        t=Thread(target=work)
        t.start()
        l.append(l)
        
   	for p in l:
        p.join()
    print(time.time()-start_time)    
```

```python
#IO å¯†é›†å‹
from multiprocessing import Process
from threading import Thread
import os ,time

def work():
    time.sleep(2)
if __name__ =='__main__':
    l=[]
    print(os.cpu_count())#è·å–å½“å‰è®¡ç®—æœºCPUä¸ªæ•°
    start_time=time.time()
    for i in range(40000):
        #p=Process(target=work)
        #p.start()
        #l.append(p)
        t=Thread(target=work)
        t.start()
        l.append(l)
        
   	for p in l:
        p.join()
    print(time.time()-start_time) 

```

æ€»ç»“ï¼š

```python
"""
å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿
å¹¶ä¸”å†åé¢å†™é¡¹ç›®éƒ½æ˜¯å¤šè¿›ç¨‹ä¸‹é¢å†å¼€è®¾å¤šçº¿ç¨‹
è¿™æ ·çš„è¯æ—¢å¯ä»¥åˆ©ç”¨å¤šæ ¸ä¹Ÿå¯ä»¥å‡å°‘èµ„æºæ¶ˆè€—
"""
```

#### æ­»é”ï¼ˆäº†è§£ï¼‰

* å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹é—´å…±äº«å¤šä¸ªèµ„æºçš„æ—¶å€™ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å æœ‰ä¸€éƒ¨åˆ†èµ„æºå¹¶ä¸”åŒæ—¶ç­‰å¾…å¯¹æ–¹çš„èµ„æºï¼Œå°±ä¼šé€ æˆæ­»é”
* å°½ç®¡æ­»é”å¾ˆå°‘ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿäº†å°±ä¼šé€ æˆåº”ç”¨çš„åœæ­¢å“åº”ï¼Œç¨‹åºä¸ä¼šåšä»»ä½•äº‹

* å½“çŸ¥é“é”çš„ä½¿ç”¨æŠ¢é”å¿…é¡»è¦é‡Šæ”¾é”ï¼Œå…¶å®åœ¨æ“ä½œé”çš„æ—¶å€™ä¹Ÿå®¹æ˜“äº§ç”Ÿæ­»é”ç°è±¡ï¼ˆæ•´ä¸ªç¨‹åºå¡æ­»ï¼Œé˜»å¡ï¼‰

```python
from threading import Thread,Lock
import time

mutexA=Lock()
mutexB=Lock()
#ç±»åªè¦åŠ æ‹¬å·å¤šæ¬¡ï¼Œäº§ç”Ÿçš„è‚¯å®šæ˜¯ä¸åŒçš„æ•ˆæœ
#å¦‚æœæƒ³è¦å®ç°å¤šæ¬¡åŠ æ‹¬å·ç­‰åˆ°çš„æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼Œå•ä¾‹æ¨¡å¼

class MyThread(Thread):
    def run(self):
        self.func1()
        self.func2()
        
    def func1(self):
        mutexA.acquire()
        print('%s æŠ¢åˆ°Aé”'%self.name)#è·å–å½“å‰çº¿ç¨‹å
        mutexB.acquire()
        print('%s æŠ¢åˆ°Bé”'%self.name)
        mutexB.release()
        mutexA.release()
        
    def func2(self):
        mutexB.acquire()
        print("%s æŠ¢åˆ°Bé”"%self.name)
        time.sleep(2)
        mutexA.acquire()
        print("%s æŠ¢åˆ°Aé”"%self.name)
        mutexA.release()
        mutexB.release()
        
if __name__ == '__main__':
    for i in range(10):
        t=MyThread()
        t.start()
```

#### é€’å½’é”ï¼ˆäº†è§£ï¼‰

é€’å½’é”çš„ç‰¹ç‚¹ï¼š

* å¯ä»¥è¿ç»­çš„acquireå’Œrelease
* ä½†æ˜¯åªèƒ½è¢«ç¬¬ä¸€ä¸ªæŠ¢åˆ°è¿™æŠŠé”æ‰§è¡Œä¸Šè¿°æ“ä½œ
* å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯acquireä¸€æ¬¡ï¼Œè®¡æ•°å™¨+1ï¼Œæ¯releaseä¸€æ¬¡ï¼Œè®¡æ•°å™¨-1
* åªè¦è®¡æ•°å™¨ä¸ä¸º0ï¼Œé‚£ä¹ˆå…¶ä»–äººéƒ½æ— æ³•æŠ¢åˆ°è¯¥é”

```python
from threading import Thread, Lock,RLock
import time

# mutexA = Lock()
# mutexB = Lock()
mutexA = mutexB = RLock()


class MyThread(Thread):
    def run(self):
        self.func1()
        self.func2()

    def func1(self):
        mutexA.acquire()
        print('%s æŠ¢åˆ°Aé”' % self.name)  # è·å–å½“å‰çº¿ç¨‹å
        mutexB.acquire()
        print('%s æŠ¢åˆ°Bé”' % self.name)
        mutexB.release()
        mutexA.release()

    def func2(self):
        mutexB.acquire()
        print("%s æŠ¢åˆ°Bé”" % self.name)
        time.sleep(2)
        mutexA.acquire()
        print("%s æŠ¢åˆ°Aé”" % self.name)
        mutexA.release()
        mutexB.release()


if __name__ == '__main__':
    for i in range(10):
        t = MyThread()
        t.start()
```



#### ä¿¡å·é‡ï¼ˆäº†è§£ï¼‰

ä¿¡å·é‡å†ä¸åŒçš„é˜¶æ®µï¼Œå¯èƒ½å¯¹åº”ä¸ç”¨çš„æŠ€æœ¯ç‚¹

åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ä¿¡å·é‡æŒ‡çš„æ˜¯é”

```python
"""
å¦‚æœæŠŠäº’æ–¥é”æ¯”å–»æˆä¸€ä¸ªå•æ‰€
é‚£ä¹ˆä¿¡å·é‡ç›¸å½“äºå¤šä¸ªå•æ‰€
"""
```

```python
from threading import Thread ,Semaphore
import time
import random
sm=Semaphore(5)#æ‹¬å·å†…å†™å‡ ï¼Œå°±è¡¨ç¤ºå¼€è®¾å‡ ä¸ªå‘ä½
def task(name):
    sm.acquire()
    print("%s æ­£åœ¨å¿™"%name)
    time.sleep(random.randint(1,5))
    sm.release()
if __name__ == '__main__':
    for i in range(20):
		t=Thread(target=task,args=('ä¼å…µ%så·'%i,))
    

```



#### Eventäº‹ä»¶ï¼ˆäº†è§£ï¼‰

ä¸€äº›è¿›ç¨‹æˆ–è€…çº¿ç¨‹éœ€è¦ç­‰å¾…å¦å¤–ä¸€äº›è¿›ç¨‹æˆ–è€…çº¿ç¨‹è¿è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½è¿è¡Œï¼Œç±»ä¼¼äºå‘å°„ä¿¡å·ä¸€æ ·

```python
from threading import Thread,Event
import time

event = Event()#ç±»ä¼¼äºé€ äº†ä¸€ä¸ªçº¢ç»¿ç¯
def light():
    print("çº¢ç¯äº®")
    time.sleep(3)
    print("ç»¿ç¯äº®")
    #å‘Šè¯‰ç­‰å¾…çº¢ç¯çš„äººå¯ä»¥èµ°äº†
    event.set()
 
def car(name):
    print("%s è½¦æ­£åœ¨ç­‰çº¢ç¯"%name)
    event.wait()#ç­‰å¾…åˆ«äººç»™ä½ å‘æ¶ˆæ¯
    print('%s è½¦åŠ æ²¹é—¨èµ°äº†'%name)

if __name__ == '__main__':
	t=Thread(target=light)
    t.start()
    
    for i in range(20):
        t=Thread(target=car,args=('%s'%i,))
        t.start()
    
	

```

#### çº¿ç¨‹qï¼ˆäº†è§£ï¼‰

Pythonçš„`queue`æ¨¡å—æä¾›äº†åŒæ­¥çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ç±»ï¼ŒåŒ…æ‹¬FIFOï¼ˆfirst in first out å…ˆè¿›å…ˆå‡ºï¼‰é˜Ÿåˆ—`Queue`ï¼ŒLIFOï¼ˆlast in first outåè¿›å…ˆå‡ºï¼‰é˜Ÿåˆ—`LifoQueue`å’Œä¼˜å…ˆçº§é˜Ÿåˆ—`PriorityQueue`ã€‚è¿™äº›é˜Ÿåˆ—éƒ½å®ç°äº†é”çš„åŸç†ï¼ˆå¯ä»¥ç†è§£ä¸ºåŸå­æ“ä½œï¼Œå³è¦ä¹ˆä¸åšï¼Œè¦ä¹ˆå°±åšå®Œï¼‰ï¼Œèƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸­ç›´æ¥ä½¿ç”¨ã€‚

å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ã€‚

```python
"""
åŒä¸€ä¸ªè¿›ç¨‹ä¸‹å¤šä¸ªçº¿ç¨‹æ•°æ®æ˜¯å…±äº«çš„
ä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸‹è¿˜ä¼šä½¿ç”¨é˜Ÿåˆ—å‘¢ï¼Ÿ
å› ä¸ºé˜Ÿåˆ—æ˜¯ç®¡é“+é”ç»„æˆçš„
æ‰€ä»¥ç”¨é˜Ÿåˆ—è¿˜æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨
"""
from threading import Thread
import queue
#ç°åœ¨ä½¿ç”¨çš„é˜Ÿåˆ—éƒ½æ˜¯åªèƒ½åœ¨æœ¬åœ°æµ‹è¯•ä½¿ç”¨

#1.é˜Ÿåˆ—q å…ˆè¿›å…ˆå‡º
q=queue.Queue(3)
q.put(1)
q.put(2)
print(q.get())#1
q.get_nowait()
q.get(timeout=3)
q.full()
q.empty()

# 2.åè¿›å…ˆå‡ºq 
q=queue.LifoQueue(3)  # last in first out
q.put(1)
q.put(2)
print(q.get()) #2


#3.ä¼˜å…ˆçº§q  å¯ä»¥ç»™æ”¾å…¥é˜Ÿåˆ—ä¸­çš„æ•°æ®è®¾ç½®è¿›å‡ºçš„ä¼˜å…ˆçº§
#putæ‹¬å·å†…æ”¾å…ƒç»„ï¼Œç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¼˜å…ˆçº§
#æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
q=queue.PriorityQueue(3)
q.put((10,'111'))
q.put((100,'222'))
q.put((0,'333'))
print(q.get())    #ï¼ˆ0,'333'ï¼‰æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
```

## 04ã€æ± 

* ç”¨æ¥ä¿è¯è®¡ç®—æœºç¡¬ä»¶å®‰å…¨çš„æƒ…å†µä¸‹æœ€å¤§é™åº¦çš„åˆ©ç”¨è®¡ç®—æœº
* å®ƒé™ä½äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œä½†æ˜¯ä¿è¯äº†è®¡ç®—æœºç¡¬ä»¶çš„å®‰å…¨ï¼Œä»è€Œè®©å†™çš„ç¨‹åºèƒ½æ­£å¸¸è¿è¡Œ

#### çº¿ç¨‹æ± ä¸è¿›ç¨‹æ± ï¼ˆæŒæ¡ï¼‰

```python
"""
æ— è®ºå¼€è®¾è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹éƒ½æ˜¯éœ€è¦æ¶ˆè€—èµ„æºçš„
åªä¸è¿‡å¼€è®¾çº¿ç¨‹çš„æ¶ˆè€—æ¯”å¼€è®¾è¿›ç¨‹çš„æ¶ˆè€—ç¨å¾®å°ä¸€ç‚¹è€Œå·²

æˆ‘ä»¬æ˜¯ä¸å¯èƒ½æ— é™åˆ¶çš„å¼€è®¾è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå› ä¸ºè®¡ç®—æœºç¡¬ä»¶çš„èµ„æºè·Ÿä¸ä¸Š ï¼Œç¡¬ä»¶çš„å¼€å‘é€Ÿåº¦è¿œè¿œèµ¶ä¸ä¸Šè½¯ä»¶

å®—æ—¨ï¼šä¿è¯åœ¨è®¡ç®—æœºç¡¬ä»¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„æƒ…å†µä¸‹æœ€å¤§é™åº¦çš„åˆ©ç”¨å®ƒ
"""
```

**ç¬¬ä¸€ç§ä½¿ç”¨**ï¼š

```python
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor
pool = ProcessPoolExecutor(5)
res = pool.submit(task, i).add_done_callback(callback)
```




* åªéœ€è¦å°†éœ€è¦åšçš„ä»»åŠ¡å¾€æ± å­é‡Œé¢ä»ï¼Œè‡ªåŠ¨ä¼šæœ‰äººæ¥æœåŠ¡ä½ 

```python
from concurrent.futures import ThreadPoolExecutor, 
ProcessPoolExecutor
import time

pool = ThreadPoolExecutor(5)  # æ± å­é‡Œé¢å›ºå®šæœ‰5ä¸ªçº¿ç¨‹
# æ‹¬å·å†…å¯ä»¥ç©¿æ•°å­—ï¼Œä¸ç©¿çš„è¯ä¼šé»˜è®¤å¼€è®¾å½“å‰è®¡ç®—æœºcpuä¸ªæ•°äº”å€çš„çº¿ç¨‹
"""
æ± å­é€ å‡ºæ¥åï¼Œé‡Œé¢ä¼šå›ºå®šå­˜5ä¸ªçº¿ç¨‹
è¿™äº”ä¸ªçº¿ç¨‹ä¸ä¼šå‡ºç°é‡å¤åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹
"""


def task(n):
    print(n,os.getpid())
    time.sleep(2)
    return n**n
"""
ä»»åŠ¡çš„æäº¤æ–¹å¼ï¼š
	åŒæ­¥ï¼šæäº¤ä»»åŠ¡åä¼šåŸåœ°ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœï¼ŒæœŸé—´ä¸ä¼šåšä»»ä½•äº‹
	å¼‚æ­¥ï¼šæäº¤ä»»åŠ¡åä¸ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œæ‰§è¡Œç»§ç»­å¾€ä¸‹æ‰§è¡Œ
	
å¼‚æ­¥æäº¤ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œåº”è¯¥é€šè¿‡å›è°ƒæœºåˆ¶æ¥è·å–
ä¸€æ—¦è¯¥ä»»åŠ¡æœ‰ç»“æœå°±ç«‹å³è§¦å‘
"""
# poo.submint(task,1)#æœæ± å­ä¸­æäº¤ä»»åŠ¡    å¼‚æ­¥æäº¤
# print('ä¸»')

t_list = []
for i in range(20):  # å¾€æ± å­ä¸­æäº¤30ä¸ªä»»åŠ¡
    res = pool.submit(task, i)
    
    # print(res.result())#åŒæ­¥æäº¤
    t_list.append(res)
# ç­‰å¾…æ± å­ä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ
	pool.shutdown()  # å…³é—­çº¿ç¨‹æ± ï¼Œç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•
	for t in t_list:
	    print(">>>", t.result())  # ç»“æœæ˜¯æœ‰åºçš„
	
	    """
	    res.result()æ‹¿åˆ°çš„æ˜¯å¼‚æ­¥æäº¤è¿”å›çš„ç»“æœ
	    """

```

```python
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor
import time, os

pool = ProcessPoolExecutor(5)
# æ‹¬å·å†…å¯ä»¥ç©¿æ•°å­—ï¼Œä¸ç©¿çš„è¯ä¼šé»˜è®¤å¼€è®¾å½“å‰è®¡ç®—æœºcpuä¸ªæ•°
"""
æ± å­é€ å‡ºæ¥åï¼Œé‡Œé¢ä¼šå›ºå®šå­˜å‡ ä¸ªè¿›ç¨‹
è¿™å‡ ä¸ªè¿›ç¨‹ä¸ä¼šå‡ºç°é‡å¤åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹
"""


def task(n):
    print(n, os.getpid())
    time.sleep(2)
    return n ** n


def callback(n):
    print('callback>>', n.result())


"""
ä»»åŠ¡çš„æäº¤æ–¹å¼ï¼š
	åŒæ­¥ï¼šæäº¤ä»»åŠ¡åä¼šåŸåœ°ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœï¼ŒæœŸé—´ä¸ä¼šåšä»»ä½•äº‹
	å¼‚æ­¥ï¼šæäº¤ä»»åŠ¡åä¸ç­‰å¾…ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œæ‰§è¡Œç»§ç»­å¾€ä¸‹æ‰§è¡Œ
"""
if __name__ == '__main__':

    t_list = []
    for i in range(20):  # å¾€æ± å­ä¸­æäº¤30ä¸ªä»»åŠ¡
        # res = pool.submit(task, i)
        res = pool.submit(task, i).add_done_callback(callback)
        # print(res.result())#åŒæ­¥æäº¤
        t_list.append(res)
        # ç­‰å¾…æ± å­ä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ
        # pool.shutdown()  # å…³é—­çº¿ç¨‹æ± ï¼Œç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•
        # for t in t_list:
        #     print(">>>", t.result())  # ç»“æœæ˜¯æœ‰åºçš„

        """
        res.result()æ‹¿åˆ°çš„æ˜¯å¼‚æ­¥æäº¤è¿”å›çš„ç»“æœ
        """

```

**ç¬¬äºŒç§ä½¿ç”¨**

```python
from multiprocessing import  Pool
pool=Pool(max)#åˆ›å»ºè¿›ç¨‹æ± å¯¹è±¡
pool.apply()#é˜»å¡
pool.apply_async()#éé˜»å¡
pool.close()
pool.join()#ä¸»è¿›ç¨‹ç­‰å¾…å…¶ä»–è¿›ç¨‹ç»“æŸ
```

* éé˜»å¡å¼

```python
"""

éé˜»å¡å¼:å…¨éƒ¨æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç«‹åˆ»è¿”å›ï¼Œæ²¡æœ‰ç­‰å¾…å…¶ä»–è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰è¿”å›

"""
from multiprocessing import Pool
import time, random
import os


# éé˜»å¡å¼è¿›ç¨‹
def task(name):
    print('å¼€å§‹ä»»åŠ¡:', name)
    start = time.time()
    time.sleep(random.random() * 2)
    end = time.time()
    # print('å®Œæˆä»»åŠ¡:{},ç”¨æ—¶ï¼š{},è¿›ç¨‹IDï¼š{}'.format(name, (end - start), os.getpid()))
    return 'å®Œæˆä»»åŠ¡:{},ç”¨æ—¶ï¼š{},è¿›ç¨‹IDï¼š{}'.format(name, (end - start), os.getpid())


containner = []


def callback_func(n):
    containner.append(n)


if __name__ == '__main__':
    pool = Pool(5)
    tasks = ['å¬éŸ³ä¹', 'æ‰“ç¯®çƒ', 'æ´—è¡£æœ', 'æ‰“æ¸¸æˆ', 'åƒé¥­', 'ç¡è§‰', 'æ•£æ­¥']
    for task1 in tasks:
        pool.apply_async(task, args=(task1,), callback=callback_func)  # éé˜»å¡

    pool.close()  # æ·»åŠ ä»»åŠ¡ç»“æŸ
    pool.join()

    for c in containner:
        print(c)
    print('over')

"""
è¿›ç¨‹æ± ï¼š

"""
```

* é˜»å¡å¼

```python
import os
import random
from multiprocessing import  Pool
import  time


def task(name):
    print('å¼€å§‹ä»»åŠ¡:', name)
    start = time.time()
    time.sleep(random.random() * 2)
    end = time.time()
    print('å®Œæˆä»»åŠ¡:{},ç”¨æ—¶ï¼š{},è¿›ç¨‹IDï¼š{}'.format(name, (end - start), os.getpid()))
    # return 'å®Œæˆä»»åŠ¡:{},ç”¨æ—¶ï¼š{},è¿›ç¨‹IDï¼š{}'.format(name, (end - start), os.getpid())

"""
é˜»å¡å¼ï¼š
æ·»åŠ ä¸€ä¸ªæ‰§è¡Œä¸€ä¸ªï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ä¸ç»“æŸï¼Œå¦ä¸€ä¸ªä»»åŠ¡è¿›ä¸æ¥

"""


if __name__ == '__main__':
    pool = Pool(5)
    tasks = ['å¬éŸ³ä¹', 'æ‰“ç¯®çƒ', 'æ´—è¡£æœ', 'æ‰“æ¸¸æˆ', 'åƒé¥­', 'ç¡è§‰', 'æ•£æ­¥']
    for task1 in tasks:
        pool.apply(task, args=(task1,))  # éé˜»å¡

    pool.close()  # æ·»åŠ ä»»åŠ¡ç»“æŸ
    pool.join()


    print('over')

```



## 05ã€åç¨‹

> å¾®çº¿ç¨‹

```python
"""
è¿›ç¨‹ï¼šèµ„æºå•ä½ï¼Œ
çº¿ç¨‹ï¼šæ‰§è¡Œå•ä½ï¼Œ
åç¨‹ï¼šè¿™ä¸ªæ¦‚å¿µå®Œå…¨æ˜¯ç¨‹åºå‘˜æ„æ·«å‡ºæ¥çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨
	å•çº¿ç¨‹ä¸‹å®ç°å¹¶å‘çš„æ•ˆæœ
	æˆ‘ä»¬ç¨‹åºå‘˜è‡ªå·±åœ¨ä»£ç å±‚é¢ä¸Šè‡ªå·±ç›‘æµ‹æ‰€æœ‰çš„IOæ“ä½œï¼Œä¸€æ—¦é‡åˆ°IOï¼Œæˆ‘ä»¬åœ¨ä»£ç çº§åˆ«å®Œæˆåˆ‡æ¢
	è¿™æ ·ç»™CPUçš„æ„Ÿè§‰æ˜¯ä½ è¿™ä¸ªç¨‹åºä¸€ç›´åœ¨è¿è¡Œï¼Œæ²¡æœ‰IOï¼Œä»è€Œæå‡è¿è¡Œæ•ˆç‡
å¤šé“æŠ€æœ¯ï¼š
	åˆ‡æ¢+ä¿å­˜çŠ¶æ€
	CPUä¸¤ç§åˆ‡æ¢ï¼š
		1.ç¨‹åºé‡åˆ°IO
		2.ç¨‹åºé•¿æ—¶é—´å ç”¨


è¿›ç¨‹ã€‹çº¿ç¨‹ã€‹åç¨‹
"""
```

##### greenletæ¨¡å—ï¼ˆäº†è§£ï¼‰

```python
import time

import greenlet


# å®Œæˆåç¨‹ä»»åŠ¡
def a():
    for i in range(5):
        print('A' + str(i))
        gb.switch()
        time.sleep(0.2)


def b():
    for i in range(5):
        print('B' + str(i))
        gc.switch()
        time.sleep(0.2)


def c():
    for i in range(5):
        print('C' + str(i))
        ga.switch()
        time.sleep(0.2)


if __name__ == '__main__':
    ga = greenlet.greenlet(a)
    gb = greenlet.greenlet(b)
    gc = greenlet.greenlet(c)
    ga.switch()


```



##### geventæ¨¡å—ï¼ˆäº†è§£ï¼‰

```python
pip install gevent
```

* æœ¬èº«æ— æ³•ç›‘æµ‹å¸¸è§çš„ä¸€äº›IOæ“ä½œ

* å¯¼å…¥çš„æ—¶å€™éœ€è¦é¢å¤–å¯¼å…¥
```python
from gevent import monkey
monkey.patch_all()
```

ç”±äºä¸Šé¢çš„ä¸¤å¥è¯åœ¨ä½¿ç”¨geventæ¨¡å—çš„æ—¶å€™è‚¯å®šè¦å¯¼å…¥çš„ï¼Œæ‰€ä»¥æ”¯æŒç®€å†™

```python
from gevent import monkey;monkey.patch_all()
```

**ä½¿ç”¨ï¼š**

```python
from gevent import spawn
from gevent import monkey
import time

def info():
    print('å“ˆå“ˆå“ˆ')
    time.sleep(2)
    print("é»‘æ¶hié»‘")
    
def msg():
    print('è‹±è¯­')
    time.sleep(2)
    print("æ•°å­¦")  
    
start_time=time.time()
g1=spawn(info)
g2=spawn(msg)
g1.join()
g2.join()#ç­‰å¾…è¢«ç›‘æµ‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†å¾€åç»§ç»­æ‰§è¡Œ
#info()
#msg()
print(time.time()-start_time)
```

* greenletå·²ç»å®ç°äº†åç¨‹ï¼Œä½†æ˜¯äººå·¥åˆ‡æ¢ï¼Œå¤ªéº»çƒ¦ï¼Œ
* å½“greenleté‡åˆ°IOï¼Œï¼ˆæŒ‡çš„æ˜¯input outputè¾“å…¥è¾“å‡ºï¼Œï¼‰æ¯”å¦‚ï¼ˆç½‘ç»œï¼Œæ–‡ä»¶æ“ä½œç­‰ï¼‰æ“ä½œæ—¶
* æ¯”å¦‚è®¿é—®ç½‘ç»œï¼Œå°±è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–çš„greenletï¼Œç­‰åˆ°IOå®Œæˆï¼Œå†é€‚åˆçš„æ—¶å€™åˆ‡æ¢å›æ¥ç»§ç»­æ‰§è¡Œ
* ç”±äºIOæ“ä½œéå¸¸è€—æ—¶ï¼Œç»å¸¸ä½¿ç¨‹åºå¤„äºç­‰å¾…çŠ¶æ€ï¼Œæœ‰äº†geventå¯ä»¥è‡ªåŠ¨åˆ‡æ¢åç¨‹,å°±ä¿è¯æ€»æœ‰greenletåœ¨è¿è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…IO

```python
"""


"""
import time
from gevent import monkey
import gevent

monkey.patch_all()#æ‰“è¡¥ä¸

# å®Œæˆåç¨‹ä»»åŠ¡
def a():
    for i in range(5):
        print('A' + str(i))

        time.sleep(0.2)


def b():
    for i in range(5):
        print('B' + str(i))

        time.sleep(0.2)


def c():
    for i in range(5):
        print('C' + str(i))

        time.sleep(0.2)


if __name__ == '__main__':
    g1 = gevent.spawn(a)
    g2 = gevent.spawn(b)
    g3 = gevent.spawn(c)
    
    g1.join()
    g2.join()
    g3.join()

```



#### åç¨‹å®ç°TCPæœåŠ¡ç«¯å¹¶å‘æ•ˆæœ

```python
"""æœåŠ¡ç«¯"""
from gevent import monkey;monkey.patch_all()
import socket
from gevent import spawn


def comunication(conn):
    # é€šä¿¡å¾ªç¯
    while True:
        try:
            data = conn.recv(1024)
            if len(data) == 0: break
            conn.send(data.upper())
        except ConnectionResetError as r:
            print(r)
            break
    conn.close()


def server(ip, port):
    server = socket.socket()
    server.bind((ip, port))
    server.listen(5)
    while True:
        # é“¾æ¥å¾ªç¯
        conn, client_addr = server.accept()
        # å¼€è®¾å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹è¿›è¡Œå®¢æˆ·ç«¯é€šä¿¡
        spawn(comunication, conn)


if __name__ == '__main__':
    g1 = spawn(server, '127.0.0.1', 8080)
    g1.join()

```



```python
"""å®¢æˆ·ç«¯"""
import socket
from threading import Thread,current_thread


def client():
    client = socket.socket()
    client.connect(('127.0.0.1', 8080))
    n = 1
    while True:
        msg='%s say hello %s'%(current_thread().name,n)
        n+=1
        client.send(msg.encode('utf-8'))
        data=client.recv(1024)
        print(data.decode('utf-8'))
if __name__ == '__main__':
    for i in range(200):
        t=Thread(target=client)
        t.start()
```

**æ€»ç»“ï¼š**

ç†æƒ³çŠ¶æ€ï¼š

* å¯ä»¥é€šè¿‡å¯¹è¿›ç¨‹ä¸‹é¢å¼€è®¾å¤šè¿›ç¨‹
* å¯ä»¥é€šè¿‡å¤šè¿›ç¨‹ä¸‹é¢å†å¼€è®¾åç¨‹
* ä»è€Œæˆ‘ä»¬çš„æ‰§è¡Œæ•ˆç‡æå‡

## 06ã€IOæ¨¡å‹

[è¯¦è§ç›¸å…³åšå®¢](https://www.cnblogs.com/Dominic-Ji/articles/10929396.html  )

  ### éé˜»å¡IO


```python
"""server.py"""
# -*- coding: UTF-8 -*-  @Date ï¼š2022/9/23 17:21
import socket, time

server = socket.socket()
server.bind(('127.0.0.1', 8080))
server.listen(5)
server.setblocking(False)  # é»˜è®¤æ˜¯true,
# å°†ç½‘ç»œé˜»å¡å˜æˆéé˜»å¡

r_List = []
del_List = []
# é“¾æ¥å¾ªç¯
while True:
    try:
        conn, addr = server.accept()
        r_List.append(conn)

    except BlockingIOError as e:
        print('åˆ—è¡¨é•¿åº¦', len(r_List))
        # print('............')
        for conn in r_List:
            try:
                data = conn.recv(1024)  # æ²¡æœ‰æ¶ˆæ¯æŠ¥é”™
                if len(data) == 0:  # å®¢æˆ·ç«¯å…³é—­é“¾æ¥
                    conn.close()  # å…³é—­conn
                    # å°†æ— ç”¨çš„connä»r_liståˆ é™¤
                    del_List.append(conn)
                    continue
                conn.send(data.upper())
            except BlockingIOError:
                continue
            except ConnectionResetError:
                conn.close()
                del_List.append(conn)
        for conn in del_List:
            r_List.remove(conn)
        del_List.clear()

```

```python
"""client.py"""
# -*- coding: UTF-8 -*-  @Date ï¼š2022/9/23 17:28
import socket


client=socket.socket()
client.connect(('127.0.0.1',8080))
while True:
    client.send(b'hello world')
    data=client.recv(1024)
    print(data)

```

```python
"""
éé˜»å¡IOæ¨¡å‹ä¼šé•¿æ—¶é—´å ç”¨CPUå¹¶ä¸”ä¸å¹²æ´»ï¼Œè®©CPUä¸åœçš„ç©ºè½¬
å®é™…åº”ç”¨ä¸­ä¹Ÿä¸ä¼šç”¨éé˜»å¡IOæ¨¡å‹
ä½†æ˜¯ä»»ä½•ä¸€ä¸ªæŠ€æœ¯ç‚¹éƒ½æœ‰å®ƒå­˜åœ¨çš„ä»·å€¼
â€å®é™…åº”ç”¨æˆ–è€…æ€æƒ³å€Ÿé‰´"
"""
```
### å¤šè·¯å¤ç”¨IO

```python

"""
å½“ç›‘ç®¡çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œå…¶å®IOå¤šè·¯å¤ç”¨è¿é˜»å¡IOéƒ½æ¯”ä¸ä¸Šï¼ï¼ï¼
ä½†æ˜¯IOå¤šè·¯å¤ç”¨å¯ä»¥ä¸€æ¬¡æ€§ç›‘ç®¡å¤šä¸ªå¯¹è±¡

server=socket.socket()
conn,addr=server.accept()

ç›‘ç®¡æœºåˆ¶æ˜¯æ“ä½œç³»ç»Ÿæœ¬èº«å°±æœ‰çš„ï¼Œå¦‚æœæƒ³ç”¨ç›‘ç®¡æœºåˆ¶(select)éœ€è¦å¯¼å…¥selectæ¨¡å—
"""
```

```python
"""server.py"""
# -*- coding: UTF-8 -*-  @Date ï¼š2022/9/23 18:02

import socket
import select

server = socket.socket()
server.bind(("127.0.0.2", 8080))
server.listen(4)
server.setblocking(False)  # å°†æ‰€æœ‰é˜»å¡å˜æˆéé˜»å¡

read_list = [server]

while True:
    r_list, w_list, x_list = select.select(read_list, [], [])
    # res = select.select(read_list, [], [])
    """
    ç›‘ç®¡å¯¹è±¡ï¼Œä¸€æ—¦æœ‰äººæ¥äº†ï¼Œå°±è¿”å›å¯¹åº”çš„ç›‘ç®¡å¯¹è±¡
    """
    # print(res)  # ([<socket.socket fd=276, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.2', 8080)>], [], [])
    # print(server)  # <socket.socket fd=768, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.2', 8080)>

    for i in r_list:
        if i is server:
            conn, addr = i.accept()
            # åº”è¯¥æŠŠconnæ·»åŠ åˆ°ç›‘ç®¡çš„é˜Ÿåˆ—ä¸­å»
            read_list.append(conn)
        else:
            res = i.recv(1024)
            if len(res) == 0:
                i.close()
                # å°†æ— æ•ˆçš„ç›‘ç®¡å¯¹è±¡ç§»é™¤
                read_list.remove(i)
                continue
            print(res)
            i.send(b"heiheiheiheihei")

```

```python
"""client.py"""
# -*- coding: UTF-8 -*-  @Date ï¼š2022/9/23 18:02
import socket

client = socket.socket()
client.connect(("127.0.0.2", 8080))

while True:
    client.send(b'hello world')
    data = client.recv(1024)
    print(data)

```

```python
"""
ç›‘ç®¡æœºåˆ¶æœ‰å¾ˆå¤š
selectæœºåˆ¶ï¼šwindows Linuxéƒ½æœ‰
pollæœºåˆ¶ï¼šåªåœ¨Linuxæœ‰ï¼Œ

pollå’Œselectéƒ½å¯ä»¥ç›‘ç®¡å¤šä¸ªå¯¹è±¡ï¼Œä½†æ˜¯pollç›‘ç®¡çš„æ•°é‡æ›´å¤š

ä¸Šè¿°selectå’Œpollæœºåˆ¶éƒ½ä¸æ˜¯å¾ˆå®Œç¾ï¼Œå½“ç›‘ç®¡å¯¹è±¡ç‰¹åˆ«å¤šçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°åŠå…¶å¤§çš„å»¶è¿Ÿå“åº”

epollæœºåˆ¶ï¼šåªåœ¨Linuxæœ‰
å®ƒç»™æ¯ä¸€ä¸ªç›‘ç®¡å¯¹è±¡éƒ½ç»‘å®šä¸€ä¸ªå›è°ƒæœºåˆ¶ä¸€æ—¦æœ‰å“åº”ï¼Œå›è°ƒæœºåˆ¶ç«‹åˆ»å‘èµ·æé†’


é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿè¿˜éœ€è¦è€ƒè™‘ä¸åŒçš„æ£€æµ‹æœºåˆ¶ï¼Œä»£ç ä¹¦å†™å¤ªè¿‡ç¹ç

selectorsæ¨¡å—ä¼šæ ¹æ®ä»£ç è·‘çš„å¹³å°çš„ä¸åŒè‡ªåŠ¨çš„é€‰æ‹©å¯¹åº”çš„ç›‘ç®¡æœºåˆ¶


"""
```
### å¼‚æ­¥IO

```python
"""
å¼‚æ­¥IOæ¨¡å‹æ˜¯æ‰€æœ‰æ¨¡å‹ä¸­æ•ˆç‡ä¸­æœ€é«˜çš„ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„

ç›¸å…³æ¨¡å—å’Œæ¡†æ¶
	æ¨¡å—ï¼šasyncioæ¨¡å—
	æ¡†æ¶ï¼šsanic,tronado twisted
		é€Ÿåº¦å¿«ï¼ï¼ï¼


"""
```

```python
# -*- coding: UTF-8 -*-  @Date ï¼š2022/9/23 18:29

import asyncio
import threading


@asyncio.coroutine
def hello():
    print('hello', threading.current_thread().name)
    yield from asyncio.sleep(1)
    print('hello', threading.current_thread().name)


loop = asyncio.get_event_loop()
tasks = [hello(), hello()]
loop.run_until_complete(asyncio.wait(tasks))
loop.close()

```
